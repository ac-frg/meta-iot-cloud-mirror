SUMMARY = "Low-code programming for event-driven applications"
HOMEPAGE = "https://nodered.org"
LICENSE = "Apache-2.0"
LIC_FILES_CHKSUM = "file://LICENSE;md5=014f1a23c3da49aa929b21a96808ab22"

SRC_URI = "\
    npm://registry.npmjs.org/;package=node-red;version=${PV};destsuffix=${UNPACKDIR}/npm \
    npmsw://${THISDIR}/${BPN}/npm-shrinkwrap.json;destsuffix=${UNPACKDIR}/npm \
    file://${BPN}.service \
"

S = "${UNPACKDIR}/npm"

inherit npm

LICENSE:${PN} = "Apache-2.0"
LICENSE:${PN}-babel-runtime = "MIT"
LICENSE:${PN}-isaacs-cliui = "ISC & MIT"
LICENSE:${PN}-isaacs-fs-minipass = "ISC"
LICENSE:${PN}-node-red-editor-api = "Apache-2.0"
LICENSE:${PN}-node-red-editor-client = "Apache-2.0"
LICENSE:${PN}-node-red-nodes = "Apache-2.0"
LICENSE:${PN}-node-red-registry = "Apache-2.0"
LICENSE:${PN}-node-red-runtime = "Apache-2.0"
LICENSE:${PN}-node-red-util = "Apache-2.0"
LICENSE:${PN}-pkgjs-parseargs = "Apache-2.0"
LICENSE:${PN}-sindresorhus-is = "MIT"
LICENSE:${PN}-szmarczak-http-timer = "MIT"
LICENSE:${PN}-types-http-cache-semantics = "MIT"
LICENSE:${PN}-types-node = "MIT"
LICENSE:${PN}-types-readable-stream = "MIT"
LICENSE:${PN}-types-ws = "MIT"
LICENSE:${PN}-abbrev = "ISC"
LICENSE:${PN}-abort-controller = "MIT"
LICENSE:${PN}-accepts = "MIT"
LICENSE:${PN}-acorn = "MIT"
LICENSE:${PN}-acorn-walk = "MIT"
LICENSE:${PN}-agent-base = "MIT"
LICENSE:${PN}-ajv = "MIT"
LICENSE:${PN}-ansi-colors = "MIT"
LICENSE:${PN}-ansi-regex = "MIT"
LICENSE:${PN}-ansi-styles = "MIT"
LICENSE:${PN}-append-field = "MIT"
LICENSE:${PN}-argparse = "Python-2.0"
LICENSE:${PN}-array-flatten = "MIT"
LICENSE:${PN}-async-mutex = "MIT"
LICENSE:${PN}-asynckit = "MIT"
LICENSE:${PN}-axios = "MIT"
LICENSE:${PN}-balanced-match = "MIT"
LICENSE:${PN}-base64-js = "MIT"
LICENSE:${PN}-basic-auth = "MIT"
LICENSE:${PN}-bcryptjs = "MIT"
LICENSE:${PN}-bl = "MIT"
LICENSE:${PN}-body-parser = "MIT"
LICENSE:${PN}-boolbase = "ISC"
LICENSE:${PN}-brace-expansion = "MIT"
LICENSE:${PN}-buffer = "MIT"
LICENSE:${PN}-buffer-from = "MIT"
LICENSE:${PN}-busboy = "MIT"
LICENSE:${PN}-bytes = "MIT"
LICENSE:${PN}-cacheable-lookup = "MIT"
LICENSE:${PN}-cacheable-request = "MIT"
LICENSE:${PN}-call-bind = "MIT"
LICENSE:${PN}-cheerio = "MIT"
LICENSE:${PN}-cheerio-select = "BSD-2-Clause"
LICENSE:${PN}-chownr = "BlueOak-1.0.0"
LICENSE:${PN}-cli-table = "MIT"
LICENSE:${PN}-clone = "MIT"
LICENSE:${PN}-color-convert = "MIT"
LICENSE:${PN}-color-name = "MIT"
LICENSE:${PN}-colors = "MIT"
LICENSE:${PN}-combined-stream = "MIT"
LICENSE:${PN}-commist = "MIT"
LICENSE:${PN}-concat-stream = "MIT"
LICENSE:${PN}-content-disposition = "MIT"
LICENSE:${PN}-content-type = "MIT"
LICENSE:${PN}-cookie = "MIT"
LICENSE:${PN}-cookie-parser = "MIT"
LICENSE:${PN}-cookie-signature = "MIT"
LICENSE:${PN}-core-util-is = "MIT"
LICENSE:${PN}-cors = "MIT"
LICENSE:${PN}-cronosjs = "ISC"
LICENSE:${PN}-cross-spawn = "MIT"
LICENSE:${PN}-css-select = "BSD-2-Clause"
LICENSE:${PN}-css-what = "BSD-2-Clause"
LICENSE:${PN}-debug = "MIT"
LICENSE:${PN}-decompress-response = "MIT"
LICENSE:${PN}-defer-to-connect = "MIT"
LICENSE:${PN}-define-data-property = "MIT"
LICENSE:${PN}-delayed-stream = "MIT"
LICENSE:${PN}-denque = "Apache-2.0"
LICENSE:${PN}-depd = "MIT"
LICENSE:${PN}-destroy = "MIT"
LICENSE:${PN}-dom-serializer = "MIT"
LICENSE:${PN}-domelementtype = "BSD-2-Clause"
LICENSE:${PN}-domhandler = "BSD-2-Clause"
LICENSE:${PN}-domutils = "BSD-2-Clause"
LICENSE:${PN}-eastasianwidth = "MIT"
LICENSE:${PN}-ee-first = "MIT"
LICENSE:${PN}-emoji-regex = "MIT"
LICENSE:${PN}-encodeurl = "MIT"
LICENSE:${PN}-enquirer = "MIT"
LICENSE:${PN}-entities = "BSD-2-Clause"
LICENSE:${PN}-es-define-property = "MIT"
LICENSE:${PN}-es-errors = "MIT"
LICENSE:${PN}-escape-html = "MIT"
LICENSE:${PN}-etag = "MIT"
LICENSE:${PN}-event-target-shim = "MIT"
LICENSE:${PN}-events = "MIT"
LICENSE:${PN}-express = "MIT"
LICENSE:${PN}-express-session = "MIT"
LICENSE:${PN}-fast-deep-equal = "MIT"
LICENSE:${PN}-fast-unique-numbers = "MIT"
LICENSE:${PN}-finalhandler = "MIT"
LICENSE:${PN}-follow-redirects = "MIT"
LICENSE:${PN}-foreground-child = "ISC"
LICENSE:${PN}-form-data = "MIT"
LICENSE:${PN}-form-data-encoder = "MIT"
LICENSE:${PN}-forwarded = "MIT"
LICENSE:${PN}-fresh = "MIT"
LICENSE:${PN}-fs-extra = "MIT"
LICENSE:${PN}-function-bind = "MIT"
LICENSE:${PN}-get-intrinsic = "MIT"
LICENSE:${PN}-get-stream = "MIT"
LICENSE:${PN}-glob = "ISC"
LICENSE:${PN}-gopd = "MIT"
LICENSE:${PN}-got = "MIT"
LICENSE:${PN}-graceful-fs = "ISC"
LICENSE:${PN}-has-property-descriptors = "MIT"
LICENSE:${PN}-has-proto = "MIT"
LICENSE:${PN}-has-symbols = "MIT"
LICENSE:${PN}-hash-sum = "MIT"
LICENSE:${PN}-hasown = "MIT"
LICENSE:${PN}-help-me = "MIT"
LICENSE:${PN}-hpagent = "MIT"
LICENSE:${PN}-htmlparser2 = "MIT"
LICENSE:${PN}-http-cache-semantics = "BSD-2-Clause"
LICENSE:${PN}-http-errors = "MIT"
LICENSE:${PN}-http2-wrapper = "MIT"
LICENSE:${PN}-https-proxy-agent = "MIT"
LICENSE:${PN}-i18next = "MIT"
LICENSE:${PN}-iconv-lite = "MIT"
LICENSE:${PN}-ieee754 = "BSD-3-Clause"
LICENSE:${PN}-inherits = "ISC"
LICENSE:${PN}-ipaddrjs = "MIT"
LICENSE:${PN}-is-fullwidth-code-point = "MIT"
LICENSE:${PN}-is-utf8 = "MIT"
LICENSE:${PN}-isarray = "MIT"
LICENSE:${PN}-isexe = "ISC"
LICENSE:${PN}-jackspeak = "BlueOak-1.0.0"
LICENSE:${PN}-js-sdsl = "MIT"
LICENSE:${PN}-js-yaml = "MIT"
LICENSE:${PN}-json-buffer = "MIT"
LICENSE:${PN}-json-schema-traverse = "MIT"
LICENSE:${PN}-json-stringify-safe = "ISC"
LICENSE:${PN}-jsonata = "MIT"
LICENSE:${PN}-jsonfile = "MIT"
LICENSE:${PN}-keyv = "MIT"
LICENSE:${PN}-lodashclonedeep = "MIT"
LICENSE:${PN}-lowercase-keys = "MIT"
LICENSE:${PN}-lru-cache = "ISC"
LICENSE:${PN}-media-typer = "MIT"
LICENSE:${PN}-memorystore = "MIT"
LICENSE:${PN}-merge-descriptors = "MIT"
LICENSE:${PN}-methods = "MIT"
LICENSE:${PN}-mime = "MIT"
LICENSE:${PN}-mime-db = "MIT"
LICENSE:${PN}-mime-types = "MIT"
LICENSE:${PN}-mimic-response = "MIT"
LICENSE:${PN}-minimatch = "ISC"
LICENSE:${PN}-minimist = "MIT"
LICENSE:${PN}-minipass = "ISC"
LICENSE:${PN}-minizlib = "MIT"
LICENSE:${PN}-mkdirp = "MIT"
LICENSE:${PN}-moment = "MIT"
LICENSE:${PN}-moment-timezone = "MIT"
LICENSE:${PN}-mqtt = "MIT"
LICENSE:${PN}-mqtt-packet = "MIT"
LICENSE:${PN}-ms = "MIT"
LICENSE:${PN}-multer = "MIT"
LICENSE:${PN}-mustache = "MIT"
LICENSE:${PN}-mute-stream = "ISC"
LICENSE:${PN}-negotiator = "MIT"
LICENSE:${PN}-node-red-admin = "Apache-2.0"
LICENSE:${PN}-node-watch = "MIT"
LICENSE:${PN}-nopt = "ISC"
LICENSE:${PN}-normalize-url = "MIT"
LICENSE:${PN}-nth-check = "BSD-2-Clause"
LICENSE:${PN}-number-allocator = "MIT"
LICENSE:${PN}-oauth2orize = "MIT"
LICENSE:${PN}-object-assign = "MIT"
LICENSE:${PN}-object-inspect = "MIT"
LICENSE:${PN}-on-finished = "MIT"
LICENSE:${PN}-on-headers = "MIT"
LICENSE:${PN}-p-cancelable = "MIT"
LICENSE:${PN}-package-json-from-dist = "BlueOak-1.0.0"
LICENSE:${PN}-parse5 = "MIT"
LICENSE:${PN}-parse5-htmlparser2-tree-adapter = "MIT"
LICENSE:${PN}-parseurl = "MIT"
LICENSE:${PN}-passport = "MIT"
LICENSE:${PN}-passport-http-bearer = "MIT"
LICENSE:${PN}-passport-oauth2-client-password = "MIT"
LICENSE:${PN}-passport-strategy = "MIT"
LICENSE:${PN}-path-key = "MIT"
LICENSE:${PN}-path-scurry = "BlueOak-1.0.0"
LICENSE:${PN}-path-to-regexp = "MIT"
LICENSE:${PN}-pause = "MIT"
LICENSE:${PN}-process = "MIT"
LICENSE:${PN}-process-nextick-args = "MIT"
LICENSE:${PN}-proxy-addr = "MIT"
LICENSE:${PN}-proxy-from-env = "MIT"
LICENSE:${PN}-pseudomap = "ISC"
LICENSE:${PN}-psl = "MIT"
LICENSE:${PN}-punycode = "MIT"
LICENSE:${PN}-qs = "BSD-3-Clause"
LICENSE:${PN}-querystringify = "MIT"
LICENSE:${PN}-quick-lru = "MIT"
LICENSE:${PN}-random-bytes = "MIT"
LICENSE:${PN}-range-parser = "MIT"
LICENSE:${PN}-raw-body = "MIT"
LICENSE:${PN}-read = "ISC"
LICENSE:${PN}-readable-stream = "MIT"
LICENSE:${PN}-regenerator-runtime = "MIT"
LICENSE:${PN}-reinterval = "MIT"
LICENSE:${PN}-require-from-string = "MIT"
LICENSE:${PN}-requires-port = "MIT"
LICENSE:${PN}-resolve-alpn = "MIT"
LICENSE:${PN}-responselike = "MIT"
LICENSE:${PN}-rfdc = "MIT"
LICENSE:${PN}-rimraf = "ISC"
LICENSE:${PN}-safe-buffer = "MIT"
LICENSE:${PN}-safer-buffer = "MIT"
LICENSE:${PN}-sax = "ISC"
LICENSE:${PN}-semver = "ISC"
LICENSE:${PN}-send = "MIT"
LICENSE:${PN}-serve-static = "MIT"
LICENSE:${PN}-set-function-length = "MIT"
LICENSE:${PN}-setprototypeof = "ISC"
LICENSE:${PN}-shebang-command = "MIT"
LICENSE:${PN}-shebang-regex = "MIT"
LICENSE:${PN}-side-channel = "MIT"
LICENSE:${PN}-signal-exit = "ISC"
LICENSE:${PN}-split2 = "ISC"
LICENSE:${PN}-statuses = "MIT"
LICENSE:${PN}-streamsearch = "MIT"
LICENSE:${PN}-stringdecoder = "MIT"
LICENSE:${PN}-string-width = "MIT"
LICENSE:${PN}-string-width-cjs = "MIT"
LICENSE:${PN}-strip-ansi = "MIT"
LICENSE:${PN}-strip-ansi-cjs = "MIT"
LICENSE:${PN}-tar = "ISC"
LICENSE:${PN}-toidentifier = "MIT"
LICENSE:${PN}-tough-cookie = "MIT"
LICENSE:${PN}-tslib = "0BSD"
LICENSE:${PN}-type-is = "MIT"
LICENSE:${PN}-typedarray = "MIT"
LICENSE:${PN}-uglify-js = "BSD-2-Clause"
LICENSE:${PN}-uid-safe = "MIT"
LICENSE:${PN}-uid2 = "MIT"
LICENSE:${PN}-undici-types = "MIT"
LICENSE:${PN}-universalify = "MIT"
LICENSE:${PN}-unpipe = "MIT"
LICENSE:${PN}-uri-js = "BSD-2-Clause"
LICENSE:${PN}-url-parse = "MIT"
LICENSE:${PN}-util-deprecate = "MIT"
LICENSE:${PN}-utils-merge = "MIT"
LICENSE:${PN}-uuid = "MIT"
LICENSE:${PN}-vary = "MIT"
LICENSE:${PN}-which = "ISC"
LICENSE:${PN}-worker-timers = "MIT"
LICENSE:${PN}-worker-timers-broker = "MIT"
LICENSE:${PN}-worker-timers-worker = "MIT"
LICENSE:${PN}-wrap-ansi = "MIT"
LICENSE:${PN}-wrap-ansi-cjs = "MIT"
LICENSE:${PN}-ws = "MIT"
LICENSE:${PN}-xml2js = "MIT"
LICENSE:${PN}-xmlbuilder = "MIT"
LICENSE:${PN}-xtend = "MIT"
LICENSE:${PN}-yallist = "ISC"


do_install:append() {
    # Service
    install -d ${D}${systemd_unitdir}/system/
    install -m 0644 ${UNPACKDIR}/${BPN}.service ${D}${systemd_unitdir}/system/

    # Remove hardware specific files
    rm -v ${D}/${bindir}/${BPN}-pi
    rm -rvf ${D}${nonarch_libdir}/node_modules/${BPN}/bin
}


inherit systemd

SYSTEMD_AUTO_ENABLE = "enable"
SYSTEMD_SERVICE:${PN} = "${BPN}.service"

FILES:${PN} += "\
    ${systemd_unitdir} \
"


INSANE_SKIP:${PN} += "already-stripped"

